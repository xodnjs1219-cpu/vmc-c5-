네, 알겠습니다. 지금까지 설계한 5가지 핵심 기능 단위 유저 플로우를 종합하여 최종 완성본으로 정리했습니다.

---

## 위치 기반 맛집 리뷰 사이트: 기능 단위 유저 플로우 (최종본)

### 유저 플로우 1: 장소(음식점) 검색

**1. 입력 (Input)**
* 사용자가 메인 페이지 상단의 검색 입력 필드에 키워드(예: 장소명, 지역명)를 입력합니다.
* 사용자가 검색 실행을 트리거합니다. (예: 키보드 엔터(Enter) 입력 또는 검색 아이콘 클릭)

**2. 처리 (Processing)**
* 시스템이 입력된 검색 키워드를 수신합니다.
* **[Edge Case]** 시스템은 키워드가 비어 있는지(null, empty string) 또는 정의된 최소/최대 길이를 충족하는지 검증합니다.
    * (유효하지 않을 시) 처리를 중단하고 '입력 유효성 오류' 피드백을 준비합니다.
* (유효할 시) 시스템은 외부 지도/장소 API(예: Kakao, Naver, Google)에 해당 키워드로 장소 목록 검색을 요청합니다.
* **[Edge Case]** 외부 API로부터 응답이 지연되거나 실패(예: 네트워크 오류, API 키 만료, 5xx 서버 오류)합니다.
    * (실패 시) 처리를 중단하고 '외부 API 오류' 피드백을 준비합니다.
* 시스템이 외부 API로부터 1개 이상의 장소 목록(이름, 주소, 업종, 좌표)을 응답받습니다.
* **[Edge Case]** API가 0개의 결과(일치하는 장소 없음)를 반환합니다.
    * (결과 없음 시) 처리를 중단하고 '검색 결과 없음' 피드백을 준비합니다.
* (성공 시) 시스템은 반환된 장소 데이터를 UI(정보 배너)에 표시할 형태로 포맷팅합니다.

**3. 출력 (Output)**
* **(성공 시)**
    * 지도 뷰가 검색된 결과의 위치(들)를 적절히 표시하도록 이동(pan) 및 확대/축소(zoom)됩니다.
    * 검색된 장소 목록이 정보 배너(장소명, 주소, 업종 포함) 형태로 사용자에게 노출됩니다.
    * 각 배너에는 '리뷰 작성' 페이지로 이동하는 UI 요소가 포함됩니다.
* **(Edge Case: 입력 유효성 오류 시)**
    * 검색 입력 필드 주변에 오류(예: 검색어를 입력하세요)를 알리는 시각적 피드백이 표시됩니다.
* **(Edge Case: 검색 결과 없음 시)**
    * 검색 결과 영역에 "검색 결과가 없습니다"와 유사한 의미의 피드백 메시지가 표시됩니다.
* **(Edge Case: 외부 API 오류 시)**
    * "검색 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요"와 유사한 의미의 스낵바 또는 모달 피드백이 표시됩니다.

---

### 유저 플로우 2: 신규 리뷰 작성 및 저장

**1. 입력 (Input)**
* 사용자가 '리뷰 작성 페이지'로 진입합니다. (이때, 대상 `placeId` 또는 장소 정보가 페이지로 전달된 상태입니다.)
* 사용자가 폼(Form)의 각 필드를 입력합니다.
    * 작성자명 (텍스트)
    * 평점 (예: 1~5점 선택)
    * 리뷰 내용 (텍스트)
    * 비밀번호 (텍스트, 수정/삭제용)
* 사용자가 '저장' (또는 '제출') 버튼을 클릭합니다.

**2. 처리 (Processing)**
* 시스템이 '저장' 이벤트를 수신하고 폼 데이터를 가져옵니다.
* **[Edge Case]** 시스템은 폼 데이터의 유효성을 검증합니다.
    * (검증 실패 1: 필수 필드 누락) 작성자명, 평점, 리뷰 내용, 비밀번호 중 하나라도 비어 있는지 확인합니다.
    * (검증 실패 2: 형식 오류) 비밀번호가 최소/최대 길이 등 정의된 규칙을 만족하는지 확인합니다.
    * (유효성 검증 실패 시) 처리를 중단하고 '유효성 오류' 피드백을 준비합니다.
* (유효성 검증 통과 시) 시스템은 입력된 비밀번호를 안전한 방식으로 해시(Hash) 처리합니다. (원본 비밀번호를 저장하지 않습니다.)
* 시스템은 폼 데이터(작성자명, 평점, 내용, 해시된 비밀번호)와 대상 장소 정보(`placeId`)를 포함하여 데이터베이스(DB)에 '신규 리뷰 생성'을 요청합니다.
* **[Edge Case]** DB 저장 중 오류가 발생합니다. (예: 네트워크 단절, DB 연결 실패, 서버 오류)
    * (실패 시) 처리를 중단하고 '서버 오류' 피드백을 준비합니다.
* (DB 저장 성공 시) 시스템은 신규 리뷰가 성공적으로 저장되었음을 확인합니다.
* 시스템은 방금 생성된 리뷰를 포함한 '장소 상세 페이지'로 사용자를 이동(redirect)시킬 준비를 합니다. (대상 `placeId` 기준)

**3. 출력 (Output)**
* **(성공 시)**
    * 사용자는 해당 장소의 '장소 상세 페이지' (`/place/[placeId]`)로 자동 이동합니다.
    * (Side Effect) 해당 장소의 '평균 평점'이 신규 리뷰를 포함하여 갱신됩니다.
    * (Side Effect) '장소 상세 페이지'의 리뷰 목록에 방금 작성한 새 리뷰가 (일반적으로 최상단에) 표시됩니다.
    * (Side Effect) 이 리뷰가 해당 장소의 첫 리뷰였다면, '메인 (지도) 페이지'에 해당 장소의 마커가 생성됩니다.
* **(Edge Case: 유효성 오류 시)**
    * 사용자는 '리뷰 작성 페이지'에 머무릅니다.
    * 각 유효성 검증에 실패한 입력 필드 하단(또는 폼 상단)에 오류를 알리는 시각적 피드백이 표시됩니다. (예: '비밀번호를 입력하세요', '평점을 선택하세요')
* **(Edge Case: 서버 오류 시)**
    * 사용자는 '리뷰 작성 페이지'에 머무릅니다.
    * "저장에 실패했습니다. 잠시 후 다시 시도해주세요"와 유사한 의미의 피드백(예: 모달, 스낵바)이 표시됩니다.

---

### 유저 플로우 3: 기존 리뷰 수정

**1. 입력 (Input)**
* 사용자가 '장소 상세 페이지'에서 특정 리뷰 항목에 있는 **'수정'** 버튼을 클릭합니다.
* 시스템이 '비밀번호 확인 모달'을 사용자에게 표시합니다.
* 사용자가 모달의 입력 필드에 **비밀번호**를 입력합니다.
* 사용자가 모달의 **'확인'** 버튼을 클릭합니다.

**2. 처리 (Processing)**
* 시스템이 '확인' 이벤트를 수신하고, 사용자가 입력한 비밀번호와 대상 `reviewId`를 가져옵니다.
* **[Edge Case 1: 입력 유효성 오류]** 사용자가 비밀번호를 입력하지 않고 '확인'을 클릭합니다.
    * (실패 시) 처리를 중단하고 '입력값 없음' 피드백을 준비합니다.
* (유효할 시) 시스템은 사용자가 입력한 비밀번호를 동일한 방식(Flow 2와 동일)으로 해시(Hash) 처리합니다.
* 시스템은 DB에 `reviewId`를 기준으로 저장된 '해시된 비밀번호'를 조회하고, 방금 해시 처리한 값과 일치하는지 비교(인증)합니다.
* **[Edge Case 2: 인증 실패]** 두 해시 값이 일치하지 않습니다. (비밀번호 불일치)
    * (실패 시) 처리를 중단하고 '인증 실패' 피드백을 준비합니다.
* **[Edge Case 3: DB 조회 오류]** 인증 과정(DB 조회) 중 서버 오류가 발생합니다.
    * (실패 시) 처리를 중단하고 '서버 오류' 피드백을 준비합니다.
* **(인증 성공 시)**
    * 시스템은 `reviewId`를 기준으로 DB에서 기존 리뷰 데이터(작성자명, 평점, 내용)를 조회합니다.
    * 시스템은 해당 데이터를 미리 채운 상태로 '리뷰 수정 페이지'(`/edit/[reviewId]`)로 이동시킬 준비를 합니다.
* (페이지 이동 후, 수정 완료 단계)
    * 사용자가 '리뷰 수정 페이지'에서 내용을 변경하고 '수정 완료' 버튼을 클릭합니다. (이 과정은 Flow 2의 '저장' 로직과 유사함)
    * 시스템은 유효성 검증 후, `reviewId`를 기준으로 DB 데이터를 업데이트(UPDATE)합니다.
    * (수정 완료 시) '장소 상세 페이지'로 다시 이동(redirect)시킵니다.

**3. 출력 (Output)**
* **[1단계: 인증]**
    * **(인증 성공 시)** '비밀번호 확인 모달'이 닫히고, 사용자는 '리뷰 수정 페이지'로 이동합니다. 해당 페이지 폼에는 기존 리뷰 내용이 채워져 있습니다.
    * **(Edge Case 1: 입력값 없음 시)** 모달이 닫히지 않고, 입력 필드 하단에 '비밀번호를 입력하세요'와 유사한 피드백이 표시됩니다.
    * **(Edge Case 2: 인증 실패 시)** 모달이 닫히지 않고, '비밀번호가 일치하지 않습니다'와 유사한 피드백이 표시됩니다.
    * **(Edge Case 3: 서버 오류 시)** 모달이 닫히고, '오류가 발생했습니다. 다시 시도해주세요'와 유사한 스낵바 피드백이 표시됩니다.
* **[2단계: 수정 완료]**
    * **(성공 시)** 사용자는 '장소 상세 페이지'로 이동하며, 리뷰 목록에서 해당 리뷰의 내용이 수정된 것을 확인합니다. (평점이 변경되었다면 '평균 평점'도 갱신됩니다.)
    * **(실패 시)** (Flow 2와 동일) '리뷰 수정 페이지'에 머무르며 오류 피드백을 받습니다.

---

### 유저 플로우 4: 기존 리뷰 삭제

**1. 입력 (Input)**
* 사용자가 '장소 상세 페이지'의 특정 리뷰 항목에서 **'삭제'** 버튼을 클릭합니다.
* 시스템이 '비밀번호 확인 모달'을 사용자에게 표시합니다. (모달은 사용자에게 이 작업이 '삭제'임을 명확히 인지시켜야 합니다.)
* 사용자가 모달의 입력 필드에 **비밀번호**를 입력합니다.
* 사용자가 모달의 **'확인'** (또는 '삭제') 버튼을 클릭합니다.

**2. 처리 (Processing)**
* 시스템이 '확인' 이벤트를 수신하고, 사용자가 입력한 비밀번호와 대상 `reviewId`를 가져옵니다.
* **[Edge Case 1: 입력 유효성 오류]** 사용자가 비밀번호를 입력하지 않고 '확인'을 클릭합니다.
    * (실패 시) 처리를 중단하고 '입력값 없음' 피드백을 준비합니다.
* (유효할 시) 시스템은 사용자가 입력한 비밀번호를 Flow 2(작성)와 동일한 방식으로 해시(Hash) 처리합니다.
* 시스템은 DB에 `reviewId`를 기준으로 저장된 '해시된 비밀번호'와 방금 생성한 해시 값을 비교(인증)합니다.
* **[Edge Case 2: 인증 실패]** 두 해시 값이 일치하지 않습니다. (비밀번호 불일치)
    * (실패 시) 처리를 중단하고 '인증 실패' 피드백을 준비합니다.
* **[Edge Case 3: DB 조회/인증 오류]** 인증 과정 중 서버 오류가 발생합니다.
    * (실패 시) 처리를 중단하고 '서버 오류' 피드백을 준비합니다.
* **(인증 성공 시)**
    * 시스템은 DB에 `reviewId`와 일치하는 리뷰 레코드를 **삭제(DELETE)**하라는 명령을 전송합니다.
    * **[Edge Case 4: DB 삭제 오류]** 삭제 명령 실행 중 오류가 발생합니다.
        * (실패 시) 처리를 중단하고 '서버 오류' 피드백을 준비합니다.
    * (삭제 성공 시) 시스템은 해당 `placeId`에 연결된 나머지 리뷰들을 기반으로 '평균 평점'을 즉시 재계산하고, 장소 정보(Place) 테이블의 평균 평점 값을 업데이트합니다.
    * **[Edge Case 5: 마지막 리뷰 삭제]** 만약 삭제된 리뷰가 해당 장소의 유일한(마지막) 리뷰였을 경우, 시스템은 '메인 (지도) 페이지'에서 해당 장소의 마커가 더 이상 표시되지 않도록 관련 상태(또는 플래그)를 업데이트합니다.

**3. 출력 (Output)**
* **(성공 시)**
    * '비밀번호 확인 모달'이 닫힙니다.
    * (Side Effect) '장소 상세 페이지'의 리뷰 목록에서 해당 리뷰 항목이 즉시 사라집니다.
    * (Side Effect) '장소 상세 페이지' 상단의 '평균 평점'이 재계산된 값으로 갱신됩니다.
    * (Side Effect - Edge Case 5) 해당 장소가 '메인 (지도) 페이지'의 마커 표시 기준(리뷰 1개 이상)을 충족하지 못하게 됩니다.
    * (선택 사항) "리뷰가 삭제되었습니다"와 유사한 의미의 스낵바/토스트 피드백이 잠시 표시됩니다.
* **(Edge Case 1: 입력값 없음 시)**
    * 모달이 닫히지 않고, 입력 필드 하단에 '비밀번호를 입력하세요'와 유사한 피드백이 표시됩니다.
* **(Edge Case 2: 인증 실패 시)**
    * 모달이 닫히지 않고, '비밀번호가 일치하지 않습니다'와 유사한 피드백이 표시됩니다.
* **(Edge Case 3 & 4: 서버 오류 시)**
    * 모달이 닫히고, "삭제 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요"와 유사한 의미의 피드백(예: 스낵바)이 표시됩니다.

---

### 유저 플로우 5: 장소 상세 정보 조회 (지도 마커 경유)

**1. 입력 (Input)**
* 사용자가 '메인 (지도) 페이지'에 접속합니다. (지도는 현재 뷰포트에 맞는, 리뷰가 1개 이상 등록된 장소들의 마커를 표시하고 있습니다.)
* 사용자가 지도 위에 표시된 특정 장소의 **마커(Marker)**를 클릭합니다.

**2. 처리 (Processing)**
* 시스템이 마커 클릭 이벤트를 감지합니다.
* 시스템은 클릭된 마커와 연결된 고유한 **`placeId`** (장소 ID)를 식별합니다.
* **[Edge Case 1: 유효하지 않은 `placeId`]** 클릭된 마커에 `placeId`가 없거나 유효하지 않은 경우 (예: 프론트엔드 상태 오류).
    * (실패 시) 처리를 중단하고 '데이터 조회 오류' 피드백을 준비합니다.
* (유효할 시) 시스템은 이 `placeId`를 사용하여 서버(DB)에 해당 장소의 상세 정보를 요청합니다.
* 서버는 DB에서 다음 정보들을 조회합니다.
    1.  장소 기본 정보 (가게명, 주소, 업종 등)
    2.  해당 `placeId`에 연결된 **모든 리뷰 목록** (최신순 정렬)
    3.  해당 리뷰들의 평점을 기반으로 계산된 **평균 평점**
* **[Edge Case 2: 데이터 조회 실패]** 서버가 DB에서 데이터를 조회하는 데 실패한 경우 (예: 5xx 서버 오류, `placeId`에 해당하는 장소가 없음-404).
    * (실패 시) 처리를 중단하고 '데이터 조회 오류' 피드백을 준비합니다.
* (조회 성공 시) 시스템은 서버로부터 장소 정보, 리뷰 목록, 평균 평점 데이터를 수신합니다.
* 시스템은 수신한 데이터를 사용하여 '장소 상세 페이지'(`/place/[placeId]`)로 이동(navigate)할 준비를 합니다.

**3. 출력 (Output)**
* **(성공 시)**
    * 사용자는 클릭한 장소의 '장소 상세 페이지'로 즉시 이동합니다.
    * 페이지 상단에는 장소 정보와 '평균 평점', '리뷰 작성하기' 버튼이 표시됩니다.
    * 페이지 하단(또는 메인 영역)에는 해당 장소에 작성된 '리뷰 목록'이 모두 표시됩니다. (각 리뷰에는 '수정', '삭제' 버튼이 포함됩니다.)
* **(Edge Case 1 & 2: 오류 발생 시)**
    * 사용자는 '메인 (지도) 페이지'에 머무릅니다. (또는 오류 페이지로 이동)
    * "장소 정보를 불러오는 데 실패했습니다."와 유사한 의미의 피드백(예: 스낵바, 토스트)이 표시됩니다.